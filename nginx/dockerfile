# Use the Nginx stable alpine image as a base
FROM nginx:stable-alpine
# Install dockerize
ENV DOCKERIZE_VERSION v0.6.1
RUN wget https://github.com/jwilder/dockerize/releases/download/$DOCKERIZE_VERSION/dockerize-alpine-linux-amd64-$DOCKERIZE_VERSION.tar.gz \
    && tar -C /usr/local/bin -xzvf dockerize-alpine-linux-amd64-$DOCKERIZE_VERSION.tar.gz \
    && rm dockerize-alpine-linux-amd64-$DOCKERIZE_VERSION.tar.gz

# Remove the default Nginx configuration files
RUN rm /etc/nginx/conf.d/default.conf

# Copy custom configuration file and static content
COPY nginx.conf /etc/nginx/conf.d/
COPY static.html /usr/share/nginx/html/

# Make sure the Nginx user owns the static content directory
RUN chown -R nginx:nginx /usr/share/nginx/html

# Start Nginx in the foreground to play nicely with Docker
CMD dockerize -wait tcp://backend-service:12345 -timeout 30s nginx -g 'daemon off;'
